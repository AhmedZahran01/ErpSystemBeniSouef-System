<Page x:Class="ErpSystemBeniSouef.Views.Pages.CustomersRegion.CashPage.CashCustomerInvoicePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      Background="#0B2A45"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:userControls="clr-namespace:ErpSystemBeniSouef.Views.UserControls"
      mc:Ignorable="d"
      d:DesignWidth="1700" d:DesignHeight="850">

    <Page.Resources>

        <!-- Palette -->
        <Color x:Key="DarkBackgroundColor">#0B2A45</Color>
        <Color x:Key="CardColor">#0F324D</Color>
        <Color x:Key="CardElevate">#133B5A</Color>
        <Color x:Key="AccentColor">#1E6FA8</Color>
        <Color x:Key="AccentSoft">#2A88C1</Color>
        <Color x:Key="MutetText">#B9D6EA</Color>
        <Color x:Key="LightText">#F6FBFF</Color>
        <Color x:Key="GridHeader">#123E5B</Color>
        <Color x:Key="DangerColor">#E04E4E</Color>
        <Color x:Key="SuccessColor">#2FA14A</Color>

        <SolidColorBrush x:Key="PageBackgroundBrush" Color="{StaticResource DarkBackgroundColor}"/>
        <SolidColorBrush x:Key="CardBrush" Color="{StaticResource CardColor}"/>
        <SolidColorBrush x:Key="CardElevateBrush" Color="{StaticResource CardElevate}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="AccentSoftBrush" Color="{StaticResource AccentSoft}"/>
        <SolidColorBrush x:Key="LightTextBrush" Color="{StaticResource LightText}"/>
        <SolidColorBrush x:Key="MutetTextBrush" Color="{StaticResource MutetText}"/>
        <SolidColorBrush x:Key="GridHeaderBrush" Color="{StaticResource GridHeader}"/>
        <SolidColorBrush x:Key="DangerBrush" Color="{StaticResource DangerColor}"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="{StaticResource SuccessColor}"/>

        <!-- Card style -->
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#00111A" BlurRadius="12" ShadowDepth="4" Opacity="0.35"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Label style (above controls) -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource MutetTextBrush}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- TextBox style -->
        <Style x:Key="InputTextBox" TargetType="TextBox">
            <Setter Property="Height" Value="30"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Foreground" Value="{StaticResource LightTextBrush}"/>
            <Setter Property="Background" Value="#0C2A3F"/>
            <Setter Property="BorderBrush" Value="#163B57"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="2"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox style -->
        <Style x:Key="InputComboBox" TargetType="ComboBox">
            <Setter Property="Height" Value="30"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Foreground" Value="{StaticResource LightTextBrush}"/>
            <Setter Property="Background" Value="#0C2A3F"/>
            <Setter Property="BorderBrush" Value="#163B57"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Padding" Value="6,0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="6">
                                <Grid>
                                    <ContentPresenter Margin="8,0,28,0"
                                                      VerticalAlignment="Center"
                                                      Content="{TemplateBinding SelectionBoxItem}"/>
                                    <ToggleButton HorizontalAlignment="Right" Width="28" Background="Transparent" BorderThickness="0" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                                        <Path Data="M 0 0 L 4 4 L 8 0 Z" Stretch="Uniform" Fill="{StaticResource MutetTextBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    </ToggleButton>
                                </Grid>
                            </Border>
                            <Popup IsOpen="{TemplateBinding IsDropDownOpen}" Placement="Bottom" AllowsTransparency="True" Focusable="False">
                                <Border Background="#082331" CornerRadius="6" Padding="6" BorderBrush="#163B57" BorderThickness="1">
                                    <ScrollViewer MaxHeight="220">
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DatePicker style: uses inner TextBox -->
        <Style x:Key="InputDatePicker" TargetType="DatePicker">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Foreground" Value="{StaticResource LightTextBrush}"/>
            <Setter Property="Background" Value="#0C2A3F"/>
            <Setter Property="BorderBrush" Value="#163B57"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="MinWidth" Value="220"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Buttons -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Height" Value="36"/>
            <Setter Property="Width" Value="120"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="6,0,6,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center" Margin="8,0"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource DangerBrush}"/>
        </Style>
        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
        </Style>

        <!-- DataGrid style -->
        <Style TargetType="DataGrid" x:Key="ModernDataGrid">
            <Setter Property="Background" Value="#071B2A"/>
            <Setter Property="Foreground" Value="{StaticResource LightTextBrush}"/>
            <Setter Property="RowBackground" Value="#082B3F"/>
            <Setter Property="AlternatingRowBackground" Value="#0A2F46"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeight" Value="32"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="ColumnHeaderHeight" Value="36"/>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{StaticResource GridHeaderBrush}"/>
                        <Setter Property="Foreground" Value="{StaticResource LightTextBrush}"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="6,0"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

    </Page.Resources>


    <Grid Margin="20">

        <!-- ROW DEFINITIONS -->
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>

            <RowDefinition Height="Auto"/>
            <!-- Row 0: Inputs -->
            <RowDefinition Height="1.6*"/>
            <!-- Row 1: Grid + InfoCard -->
            <RowDefinition Height="1.2*"/>
            <!-- Row 2: Customer Table -->
            <!--<RowDefinition Height="Auto"/>-->
            <!-- Row 3: Back Button -->
        </Grid.RowDefinitions>
        <userControls:TitleBar Grid.Row="0" Margin="0,0,0,8"/>

        <!-- ========================================================== -->
        <!-- ROW 0 → PRODUCT INPUTS                                    -->
        <!-- ========================================================== -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" FlowDirection="RightToLeft"
                    HorizontalAlignment="Center" Margin="0,0,0,25">

            <StackPanel Margin="0,0,20,0">
                <TextBlock Text="نوع المنتج" Foreground="White"/>
                <ComboBox x:Name="ProductTypeCombo" Width="120"  Height="28" 
                                  SelectionChanged="cbProductType_SelectionChanged"/>
            </StackPanel>

            <StackPanel Margin="0,0,20,0">
                <TextBlock Text="المنتج" Foreground="White"/>
                <ComboBox x:Name="ProductCombo"  Width="120"  Height="28" 
                           DisplayMemberPath="ProductName"  
                              SelectionChanged="cbProduct_SelectionChanged"
                          SelectedValuePath="Id"/>
            </StackPanel>

            <StackPanel Margin="0,0,20,0">
                <TextBlock Text="الكمية" Foreground="White"/>
                <TextBox x:Name="QuantityTxt"  Style="{StaticResource InputTextBox}"/>
            </StackPanel>

            <StackPanel Margin="0,0,20,0">
                <TextBlock Text="السعر" Foreground="White"/>
                <TextBox x:Name="PriceTxt" Width="120"  Style="{StaticResource InputTextBox}"/>
            </StackPanel>

            <Button Content="إضافة" Style="{StaticResource PrimaryButton}"
                    Margin="20,15,0,0" Click="AddProductBtn_Click"/>
        </StackPanel>

        <!-- ========================================================== -->
        <!-- ROW 1 → TWO COLUMNS                                        -->
        <!-- ========================================================== -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <!-- Left: Items Table -->
                <ColumnDefinition Width="350"/>
                <!-- Right: Info Card -->
            </Grid.ColumnDefinitions>

            <!-- LEFT SIDE: ITEMS TABLE -->
            <!--    Background="#0F324D" -->
            <Border Grid.Column="0" Background="#071B2A" Padding="10" CornerRadius="10">
                <DataGrid x:Name="ItemsDataGrid" AutoGenerateColumns="False"
                          FlowDirection="RightToLeft"
                          Style="{StaticResource ModernDataGrid}"
                            
 ScrollViewer.VerticalScrollBarVisibility="Visible"
 ScrollViewer.CanContentScroll="True"
                           >
                    <!--MouseDoubleClick="CustomersGrid_MouseDoubleClick"-->

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="الرقم" Binding="{Binding DisplayId}" Width=".7*"/>
                        <DataGridTextColumn Header="نوع المنتج" Binding="{Binding ProductCategoryName}" Width="*"  />
                        <DataGridTextColumn Header="المنتج" Binding="{Binding ProductName}"        Width="*"  />
                        <DataGridTextColumn Header="السعر" Binding="{Binding Price}"           Width="*"  />
                        <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity}"       Width="*"  />
                        <DataGridTextColumn Header="الإجمالي" Binding="{Binding Total}"         Width="*"  />
                        <!--<DataGridTextColumn Header="رقم نوع المنتج " Binding="{Binding Total}"         Width="*"  />-->
                    </DataGrid.Columns>


                </DataGrid>
            </Border>

            <!-- RIGHT SIDE: INFO CARD -->
            <Border Grid.Column="1" Background="#0F324D" Padding="15" 
                    CornerRadius="10" FlowDirection="RightToLeft" Margin="30,0,0,0">
                <StackPanel>
                    <StackPanel Margin="0,0,80,0">
                        <TextBlock Text="تاريخ البيع" Foreground="White"  Style="{StaticResource FieldLabel}"/>
                        <!--<TextBox x:Name="SaleDateTxt" Margin="0,0,0,10"/>-->
                        <DatePicker x:Name="SaleDateTxt"  Foreground="Black" Style="{StaticResource InputDatePicker}"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="المندوب" Foreground="White" Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="RepresentativeCombo" Margin="0,0,0,0"
                               DisplayMemberPath="Name" Width="120"  Height="24" 
                                               SelectedValuePath="Id"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="  المنطقة الاساسيه" Foreground="White"  Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="MainAreaCombo" Margin="0,0,0,0" DisplayMemberPath="Name" SelectedValuePath="Id" Height="24" Width="120" SelectionChanged="cbMainArea_SelectionChanged"/>
                        <TextBlock Text="المنطقة الفرعيه" Foreground="White"  Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="subAreaCombo" Margin="0,0,0,0" DisplayMemberPath="Name" SelectedValuePath="Id" Height="24"   Width="120" />
                    </StackPanel>

                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="المبلغ الإجمالي" Foreground="White"  Style="{StaticResource FieldLabel}"/>
                        <TextBox x:Name="TotalAmountTxt" IsEnabled="False"  Width="160" Style="{StaticResource InputTextBox}" Margin="0,0,0,10"/>
                    </StackPanel>

                    <!-- BUTTONS -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" FlowDirection="RightToLeft" Margin="0,10,0,0">
                        <Button Content="إضافة" Style="{StaticResource PrimaryButton}" Margin="10,0" Click="AddCashCustomerBtn_Click"/>
                        <Button Content="حذف" Style="{StaticResource DangerButton}" Click="DeleteCashCustomerBtn_Click"/>
                    </StackPanel>

                </StackPanel>
            </Border>

        </Grid>

        <!-- ========================================================== -->
        <!-- ROW 2 → CUSTOMER DATA GRID                                  -->
        <!-- ========================================================== -->
        <Grid  Grid.Row="3" >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="110"/>
                <!-- Left: Items Table -->
                <ColumnDefinition Width="*"/>
                <!-- Right: Info Card -->
            </Grid.ColumnDefinitions>
            <Border  Grid.Row="3" Grid.Column="1" Background="#071B2A" Padding="8" CornerRadius="10" Margin="0,25,0,25">

                <DataGrid x:Name="CashDataGrid" AutoGenerateColumns="False"
                      FlowDirection="RightToLeft"
                          Style="{StaticResource ModernDataGrid}" 
                         ScrollViewer.VerticalScrollBarVisibility="Visible"
                         ScrollViewer.CanContentScroll="True"
                         SelectionChanged="CustomersGrid_SelectionChanged"  
                          >
                         <!--MouseDoubleClick="CustomersGrid_MouseDoubleClick"-->

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="الرقم المسلسل من ال DB" Binding="{Binding serialNumberIdFromDB}" Width=".9*"/>
                        <DataGridTextColumn Header="الرقم المسلسل" Binding="{Binding serialNumber}" Width=".7*"/>
                        <DataGridTextColumn Header="تاريخ البيع" Binding="{Binding SaleDate}" Width="1.1*" />
                        <!--<DataGridTextColumn Header="الرقم المسلسل" Binding="{Binding DisplayId}" Width=".8*"/>-->
                        <DataGridTextColumn Header="اسم المندوب" Binding="{Binding RepresentativeName}" Width=".8*"/>
                        <DataGridTextColumn Header="المنطقة الاساسيه" Binding="{Binding MainAreaName}" Width="1.1*"/>
                        <DataGridTextColumn Header="المنطقة الفرعيه" Binding="{Binding SubAreaName}" Width=".9*"/>
                        <DataGridTextColumn Header=" الاجمالي " Binding="{Binding total}" Width=".8*" />

                    </DataGrid.Columns>

                </DataGrid>
            </Border>

            <Grid Grid.Row="3" Grid.Column="0">
                <Button   VerticalAlignment="Bottom" HorizontalAlignment="Left" 
                          Content="↩" FontSize="35" 
                          Width="90" Height="48" Foreground="White"
                          Style="{StaticResource triggerrr}" Margin="1,0,0,1"  
                          Click="BackBtn_Click"/>


            </Grid>
        </Grid>

        <!-- ========================================================== -->
        <!-- ROW 3 → BACK BUTTON                                        -->
        <!-- ========================================================== -->

    </Grid>

</Page>
